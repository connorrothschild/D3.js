<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Testing Scrollama</title>
  <meta name="description" content="Testing Scrollama">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' href='./style.css'>
  <style>
    #scrolly {
      position: relative;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      background-color: #f3f3f3;
      padding: 1rem;
    }

    #scrolly > * {
      -webkit-box-flex: 1;
      -ms-flex: 1;
      flex: 1;
    }


    article {
      position: relative;
      padding: 0 1rem;
      max-width: 20rem;
    }

    figure {
      position: -webkit-sticky;
      position: sticky;
      width: 100%;
      margin: 0;
      -webkit-transform: translate3d(0, 0, 0);
      -moz-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
      background-color: #8a8a8a;
    }

    figure p {
      text-align: center;
      padding: 1rem;
      position: absolute;
      top: 50%;
      left: 50%;
      -moz-transform: translate(-50%, -50%);
      -webkit-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
      font-size: 8rem;
      font-weight: 900;
      color: #fff;
    }


    .step {
      margin: 0 auto 2rem auto;
      background-color: #3b3b3b;
      color: #fff;
    }

    .step:last-child {
      margin-bottom: 0;
    }

    .step.is-active {
      background-color: goldenrod;
      color: #3b3b3b;
    }

    .step p {
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
    }
  </style>

</head>

<!DOCTYPE html>
<html>
<head>
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
  <meta charset="utf-8">
  <title>JS Bin</title>
  <script type="text/javascript" src="https://mkfreeman.github.io/scrolling/js/scroller.js"></script>
    <script type="text/javascript" src="https://mkfreeman.github.io/scrolling/js/queue.js"></script>
</head>
<body>

<div id='graphic'>
    <div id='sections'>
          <section class="step">
          <div class="title">First step</div>
           <text>This is the first step.</text>
    </section>
      <section class="step">
          <div class="title">Second step</div>
           <text>Some more text.</text>
    </section>
      <section class="step">
          <div class="title">Step 3</div>
           <text>Some text.</text>
    </section>
      <section class="step">
          <div class="title">4</div>
           <text>Some text.</text>
    </section>
      <section class="step">
          <div class="title">5</div>
           <text>Some text.</text>
    </section>
    </div>
    <div id="body"></div>
</div>

<script>

//data and such, from automation file

var margin = {top: 20, right: 20, bottom: 40, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// setup x 
var xValue = function(d) { return d.A_MEDIAN;}, // data -> value
    xScale = d3.scale.linear().range([0, width]), // value -> display
    xMap = function(d) { return xScale(xValue(d));}, // data -> display
    xAxis = d3.svg.axis().scale(xScale).outerTickSize(0).orient("bottom");

// setup y
var yValue = function(d) { return d.probability*100;}, // data -> value
    yScale = d3.scale.linear().range([height, 0]), // value -> display
    yMap = function(d) { return yScale(yValue(d));}, // data -> display
    yAxis = d3.svg.axis().scale(yScale).outerTickSize(0).orient("left");

// setup fill color
var cValue = function(d) { return d.typicaled;},
    color = d3.scale.category10();
  
//setup circle size
var circSize = function(d) { return d.TOT_EMP;} // data -> value

// add the graph canvas to the body of the webpage
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// add the tooltip area to the webpage
var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

// load data
d3.csv("https://raw.githubusercontent.com/connorrothschild/automation/master/automation_data.csv", 
       function(error, data) {

  // change string (from CSV) into number format
  data.forEach(function(d) {
    //d.row = +d.row;
    //d.occupation = +d.occupation;
    //d.lessthanhs = +d.lessthanhs;
    //d.hsdiploma = +d.hsdiploma;
    //d.somecollege = +d.somecollege;
    //d.associates = +d.associates;
    //d.bachelors = +d.bachelors;
    //d.masters = +d.masters;
    //d.professional = +d.professional;
    //d.hsorless = +d.hsorless;
    //d.somecollegeorassociates = +d.somecollegeorassociates;
    //d.postgrad = +d.postgrad;
    d.TOT_EMP = +d.TOT_EMP;
    d.A_MEDIAN = +d.A_MEDIAN;
    //d.natlwage = +d.natlwage;
    //d.typicaled = +d.typicaled;
    //d.workexp = +d.workexp;
    d.probability = +d.probability;
    //d.total =+d.total;
    return d;
    //console.log(d);
  });

// don't want dots overlapping axis, so add in buffer to data domain
  xScale.domain([d3.min(data, xValue) - (d3.min(data, xValue) * .25), 
                 d3.max(data, xValue) - (d3.max(data, xValue) * -.05)]);
  yScale.domain([d3.min(data, yValue) - (d3.min(data, yValue) * 25), 
                 d3.max(data, yValue) - (d3.max(data, yValue) * -.10)]);

// define size with dynamic #s
var size = d3.scale.linear()
  .domain([0, d3.max(data, circSize)])  // What's in the data
  .range([5, 30]);
  
  // x-axis
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -5)
      .style("text-anchor", "end")
      .text("Median Income");

  // y-axis
  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", 165)
      .attr("y", 1)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Probability of Automation");

  // draw dots
  svg.selectAll(".dot")
      .data(data)
      .enter()
      .append("circle")
      .attr("r", function(d) { return size(d.TOT_EMP); })
      // to remove size mapping to radius:
      //.attr("r", 5)
      .attr("class", "dot")
      .attr("cx", xMap)
      .attr("cy", yMap)
      .style("fill", function(d) { return color(cValue(d));})
      .on("mouseover", function(d) {
          tooltip.transition()
               .duration(200)
               .style("opacity", 1);
          tooltip.html("Occupation: " + d.occupation + 
                       "<br/> \n Income: $" + xValue(d) + 
                       "<br/> \n Probability of Automation: " + 
                       Math.round(yValue(d)) + "%")
               .style("left", (d3.event.pageX + 5) + "px")
               .style("top", (d3.event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
          tooltip.transition()
               .duration(500)
               .style("opacity", 0);
      });

  // draw legend
  var legend = svg.selectAll(".legend")
      .data(color.domain())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  // draw legend colored rectangles
  legend.append("rect")
      .attr("x", width - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  // draw legend text
  legend.append("text")
      .attr("x", width - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d;})
});

// Settings object
//var settings = {
//  showX: true, 
//  showY:false,
//}

// margins
var margin = {top: 20, right: 20, bottom: 40, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// SVG to work with
var svg = d3.select('#body')
  .append('svg')
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)

// Circle positioning function

// ********* Change the "cy" attribute to reflect the showY setting ********
var circleFunc = function(circle) {
    circle.attr('r', 15)
          .attr('fill', 'red')
          .attr('cx', function(d) { return d;})
          .attr('cy', function(d) { return d;})
}

// Reusable drawing function
var draw = function(data) {
    // Bind self.settings.data
    var circles = svg.selectAll('circle').data(data)
  
    // Enter new elements
    circles.enter().append('circle').call(circleFunc)
  
    // Exit elements that may have left
    circles.exit().remove()
  
    // Transition all circles to new dself.settings.data
    svg.selectAll('circle').transition().duration(1500).call(circleFunc)  
}

// Define data, xScale, yScale

//var xScale = d3.scale.linear().range([100,200]).domain([0,5])
//var yScale = d3.scale.linear().range([100,200]).domain([0,5])

// ******* Change the showX and showY function for some cases ********
var update = function(value) {
  switch(value) {
    case 1:
      var data = d
      break;
    case 2: 
      var data = d[6]
      //settings.showX = true
      //settings.showY = true
      break;
    case 3: 
      var data = d[5]
       //settings.showX = false
       break;
    case 4: 
      var data = d[8]
       //settings.showY = false
       break;
    default:
      //settings.showX = true
      //settings.showY = true
      var data = d[12]
      break;
  }
  draw(data)
}
// setup scroll functionality
var scroll = scroller()
    .container(d3.select('#graphic'));

// pass in .step selection as the steps
scroll(d3.selectAll('.step'));

// Pass in desired update function


// Pass the update function to the scroll object
scroll.update(update)

    </script>
  </body>
</html>
  <!-- libraries -->